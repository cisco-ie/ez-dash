version: '3'
services:
    influx:
      image: influxdb
    elasticsearch:
      image: docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.3
      environment:
        - discovery.type=single-node
        - http.port=9200
        - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
        - bootstrap.memory_lock=true
    metricbeat:
      image: ez-dash/metricbeat
      volumes:
        - "./metricbeat/metricbeat.yml:/usr/share/metricbeat/metricbeat.yml:ro"
        - "/var/run/docker.sock:/var/run/docker.sock:ro"
    kibana:
      image: docker.elastic.co/kibana/kibana-oss:6.2.3
      ports:
        - "5601:5601"
    prometheus:
      image: prom/prometheus
      volumes:
        - "./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro"
        - "./prometheus/rules.d:/etc/prometheus/rules.d:ro"
      ports:
        - "9090:9090"
    grafana:
      image: grafana/grafana
      ports:
        - "3000:3000"
      volumes:
        - "./grafana/datasources.yml:/etc/grafana/provisioning/datasources/datasources.yml:ro"
    python_app:
      image: ez-dash/python
      stdin_open: true
      tty: true
      ports:
        - "9091:9091"
      depends_on:
        - influx
        - prometheus
        - elasticsearch
