version: '3'
services:
    influx:
      image: influxdb
      ports:
        - "8086:8086"
        - "8083:8083"
    elasticsearch:
      image: docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.3
      ports:
        - "9200:9200"
        - "9300:9300"
      environment:
        - discovery.type=single-node
        - http.port=9200
        - http.cors.allow-origin="*"
        - http.cors.enabled=true
        - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization
        - http.cors.allow-credentials=true
        - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
        - bootstrap.memory_lock=true
    filebeat:
      image: ez-dash/filebeat
      volumes:
        - "./filebeat/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro"
        - "/var/lib/docker/containers:/var/lib/docker/containers:ro"
        - "/var/run/docker.sock:/var/run/docker.sock:ro"
    dejavu:
      image: appbaseio/dejavu
      ports:
        - "1358:1358"
    prometheus:
      image: prom/prometheus
      volumes:
        - "./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro"
        - "./prometheus/rules.d:/etc/prometheus/rules.d:ro"
      ports:
        - "9090:9090"
    grafana:
      image: grafana/grafana
      ports:
        - "3000:3000"
    python_app:
      image: ez-dash/python
      stdin_open: true
      tty: true
      ports:
        - "9091:9091"
      depends_on:
        - influx
        - prometheus
        - elasticsearch
